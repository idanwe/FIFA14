// Generated by CoffeeScript 1.6.3
(function() {
  var HOUR, Hapi, MINUTE, TeamsFetcher, defaults, server;

  Hapi = require("hapi");

  TeamsFetcher = require("./teamsFetcher");

  defaults = {
    port: +process.env.PORT || 8000
  };

  server = new Hapi.Server(defaults.port, "0.0.0.0");

  MINUTE = 60 * 1000;

  HOUR = 60 * MINUTE;

  server.method('getUefaClubs', TeamsFetcher.getUefaClubs, {
    cache: {
      expiresIn: 1 * HOUR,
      staleIn: 30 * MINUTE,
      staleTimeout: 500
    },
    generateKey: function(endpoint, params) {
      return endpoint + JSON.stringify(params);
    }
  });

  server.route([
    {
      method: "GET",
      path: "/clubs",
      config: {
        handler: function(request, reply) {
          return server.methods.getUefaClubs(function(err, result) {
            return reply(err ? err : result);
          });
        }
      }
    }, {
      method: "GET",
      path: "/countries",
      config: {
        handler: function(request, reply) {
          return TeamsFetcher.getWorldCupTeams(function(err, result) {
            return reply(err ? err : result);
          });
        }
      }
    }, {
      method: "GET",
      path: "/{path*}",
      handler: {
        directory: {
          path: "./app",
          listing: false,
          index: true
        }
      }
    }
  ]);

  server.start(function() {
    server.info.uri = process.env.HOST != null ? "http://" + process.env.HOST + ":" + process.env.PORT : server.info.uri;
    return console.log("Server started at " + server.info.uri);
  });

}).call(this);
